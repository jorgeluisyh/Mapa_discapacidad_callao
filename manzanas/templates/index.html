{% load static %}
{% load leaflet_tags %}
<html>
  <head>
    {% leaflet_js %}
    {% leaflet_css %}
    <style type="text/css">
      .leaflet-container { height: 100%; }      
    </style>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="{% static 'styles1.css' %}">

    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">


    <style type="text/css">

      html,
        body {
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: #657280;

        }

      .flex-fill {
            flex: 1 1 auto;
        }
 
      #logoInei{
      width: auto;
      height:60px;
      vertical-align: text-top;}


      h2 {
              font-family: bookman;
              }
    

      .leyenda { 

                padding: 6px 8px;
                font: 14px Arial, Helvetica, sans-serif;
                background: rgba(255, 255, 255, 0.8);
                /*background: rgba(255, 255, 255, 0.8);
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);*/

                border-radius: 5px;
                line-height: 24px;
                color: #555;
                bottom: 40px;

              }
      .leyenda span {
                position: relative;
                bottom: 3px;
              }

      /*.leyenda z { width : 3em; float : left }*/

      .leyenda z {
          width: 3em;
          height: 18px;
          float: left;
          margin: 0 8px 0 0;
          opacity: 0.7;
          }

      .fuente {
        font-family: verdana;
        font-size: 50%;
        line-height:10px;
      }

      .info{
        padding: 6px 8px;
        font: 14px/16px Arial, Helvetica, sans-serif;
        background: white;
        background: rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
        border-radius: 5px;

      }

      .info h4{
      margin: 0 0 5px;
      color: #777;
      }

      

    </style>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">


 

    <script type="text/javascript">

      function querycolor(field){
        if (field==0){
          return 'gray'
        }else if(field < 30){
          return 'rgb(255,255,0)';
        }else if(field < 60){
          return 'rgb(255,189,0)';
        }else if(field < 100){
          return 'rgb(255,136,0)';
        }else if(field < 150){
          return 'rgb(179,93,5)'
        }else if(field <526){
          return 'rgb(177,0,0)';
        }
      }

      function ShapeStyle(feature){

        return{
          fillColor :querycolor(feature.properties.discapac),
          weight: 0,
          opacity: 1,
          color : 'white',
          dashArray: 3,
          fillOpacity: 0.6,         
        }}


      function mostrar(feature, layer) {
                var props = feature.properties;
                var content = `<p> Discapacidad Total = ${props.discapac}</br>
                              hombres = ${props.dishom}</br>
                              mujeres = ${props.dismuj}</p>`
                <!--var content = `<img width="300" src="${props.picture_url}"/><h3>${props.title}</h3><p>${props.description}</p>`;-->
                layer.bindPopup(content);
            }


      function ShapeStyle(feature){

        return{
          fillColor :querycolor(feature.properties.discapac),
          weight: 0,
          opacity: 1,
          color : 'white',
          dashArray: 3,
          fillOpacity: 0.8,         
        }}
      function ShapeStyleHom(feature){

              return{
                fillColor :querycolor(feature.properties.dishom),
                weight: 0,
                opacity: 1,
                color : 'white',
                dashArray: 3,
                fillOpacity: 0.8,         
              }}
      function ShapeStyleMuj(feature){

              return{
                fillColor :querycolor(feature.properties.dismuj),
                weight: 0,
                opacity: 1,
                color : 'white',
                dashArray: 3,
                fillOpacity: 0.8,         
              }}


      
      var dataurl = '{% url "data" %}';

      


      window.addEventListener("map:init", function (event) {
        var map = event.detail.map;
        

         // works

         var info = L.control({
            position: 'topleft'
        });

        info.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info');
            this.update();
            return this._div;};
        info.update = function (props) {
            this._div.innerHTML = '<h3> Information site</h3>' + (props ?
                '<b>' + props.commune + '</b><br>  Ref : ' + props.ref + '<br /> Profondeur: ' + props.profondeur + ' cm | Horizons : ' + props.horizon + '' : 'Selectionner un point');
        };
        // var controlLayer =map.layerscontrol;
        info.addTo(map);


        var controlLayer =L.control.layers(null, null, {collapsed:false}).addTo(map);
        controlLayer.setPosition('bottomright')
        // Download GeoJSON data with Ajax
        fetch(dataurl)
          .then(function(resp) {
            return resp.json();
          })
          .then(function(data) {          

          var discapTotal = L.geoJson(data, {
              style: ShapeStyle,
              onEachFeature: mostrar
                            }).addTo(map);

          controlLayer.addBaseLayer(discapTotal,'Discapacidad Total');
       
          var discapHombres = L.geoJson(data, {
              style: ShapeStyleHom,
              onEachFeature: mostrar
                            });

          controlLayer.addBaseLayer(discapHombres,'Discapacidad Hombres');
       
          var discapMujeres = L.geoJson(data, {
              style: ShapeStyleMuj,
              onEachFeature: mostrar
                            });

          var overlayMaps = {
                              "Discapacidad Total": discapTotal,
                              "Discapacidad Hombres": discapHombres,
                              "Discapacidad Mujeres": discapMujeres
            };


          // addOverlay   
          controlLayer.addBaseLayer(discapMujeres,'Discapacidad Mujeres');
          });
      

          var legend = L.control({position: 'bottomleft'});
          legend.onAdd = function(map){
            var el_label = L.DomUtil.create('div','leyenda');
            var labels = [
              "151&nbsp&nbsp;-&nbsp&nbsp&nbsp&nbsp;526",
              "101&nbsp&nbsp;-&nbsp&nbsp&nbsp&nbsp;150",
              "&nbsp&nbsp61&nbsp&nbsp;-&nbsp&nbsp&nbsp&nbsp;100",
              "&nbsp&nbsp31&nbsp&nbsp;-&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;60",
              "&nbsp&nbsp&nbsp&nbsp1&nbsp&nbsp;-&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp;30",
              "&nbsp&nbsp&nbsp&nbsp;0"
            ];
            var grades = [525,149,99,59,29,0];
            el_label.innerHTML = '<div><b><CENTER>Leyenda</CENTER></b></div>';
            el_label.innerHTML += '<div><b>Población</b></div>';
            for(var i=0; i< grades.length; i++){
              el_label.innerHTML += '<z style="background:'  
              + querycolor(grades[i])+'">&nbsp;&nbsp;</z>&nbsp;&nbsp;'
              + labels[i] + '<br/>';
            }
            el_label.innerHTML += '<div class = "fuente"><p>Fuente: Instituto Nacional de Estadística e Informática</br> - Censos Nacionales de Población y Vivienda 2017</p></div>';
            return el_label;
          }
          legend.addTo(map);
      });
    </script>
  </head>
  <body>
    <div id="header">
      <nav class="navbar" style="background-color: #1c5ea5!important">
        <a class="navbar-brand" href="#">
            <img id="logoInei" src="http://ods.inei.gob.pe/ods/images/logos/logo_inei.png">
        </a>
        <h2 class="animated bounce infinite" style="text-align: center; width: 75%;color:white;" itemprop="headline"><a rel="bookmark">Región Callao: Población censada con alguna discapacidad, 2017.</a></h2>

        <div class="navbar-toggler">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarContent"
                    aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
      </nav>

    </div>






          <div id="map" class="map">
          {% leaflet_map "main" %}
          </div>


      <footer class="page-footer font-small">
          <div class="footer-copyright text-center">© 2019 Copyright</div>
        </footer>



    
  </body>
</html>
